---
- name: Prueba con WHEN. Actualizar PHP si es menor de 8.1
  hosts: all

  tasks:

  - name: Comprobar versi√≥n de PHP
    ansible.builtin.shell:
      cmd: php -v | php --version | head -n 1 | cut -c 5-10
    register: resultado
    when: resultado.stdout != "8.1.17" and ansible_distribution == "Ubuntu"

  - name: Visualizar resultado. Solo como ejemplo
    ansible.builtin.debug:
      msg: "{{resultado.stdout}}"
    when: resultado.stdout != "8.1.17" and ansible_distribution == "Ubuntu"
    
  - name: Actualizar PHP
    ansible.builtin.apt:
      name: php8.1
    when: resultado.stdout != "8.1.17" and ansible_distribution == "Ubuntu"